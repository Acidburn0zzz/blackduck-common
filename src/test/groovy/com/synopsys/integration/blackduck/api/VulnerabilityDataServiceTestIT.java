package com.synopsys.integration.blackduck.api;

import static org.junit.jupiter.api.Assertions.*;

import java.util.List;

import org.junit.jupiter.api.Tag;
import org.junit.jupiter.api.Test;

import com.synopsys.integration.bdio.SimpleBdioFactory;
import com.synopsys.integration.bdio.model.externalid.ExternalId;
import com.synopsys.integration.blackduck.api.generated.view.VulnerabilityV2View;
import com.synopsys.integration.blackduck.rest.RestConnectionTestHelper;
import com.synopsys.integration.blackduck.service.BlackDuckServicesFactory;
import com.synopsys.integration.blackduck.service.ComponentService;

@Tag("integration")
public class VulnerabilityDataServiceTestIT {
    private final RestConnectionTestHelper restConnectionTestHelper = new RestConnectionTestHelper();

    @Test
    public void testGetCommonsFileUploadVulns() throws Exception {
        final BlackDuckServicesFactory blackDuckServicesFactory = restConnectionTestHelper.createBlackDuckServicesFactory();
        final ComponentService vulnerabilityService = blackDuckServicesFactory.createComponentService();
        final SimpleBdioFactory simpleBdioFactory = new SimpleBdioFactory();

        final ExternalId commonsFileUploadExternalId = simpleBdioFactory.createMavenExternalId("commons-fileupload", "commons-fileupload", "1.2.2");
        List<VulnerabilityV2View> vulnerabilities = vulnerabilityService.getVulnerabilitiesFromComponentVersion(commonsFileUploadExternalId);
        System.out.println(vulnerabilities);
        assertNotNull(vulnerabilities);
        assertFalse(vulnerabilities.isEmpty());

        final ExternalId integrationCommonExternalId = simpleBdioFactory.createMavenExternalId("com.blackducksoftware.integration", "integration-common", "15.0.0");
        vulnerabilities = vulnerabilityService.getVulnerabilitiesFromComponentVersion(integrationCommonExternalId);
        System.out.println(vulnerabilities);
        assertNotNull(vulnerabilities);
        assertTrue(vulnerabilities.isEmpty());
    }

}
